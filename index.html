<script>
    async function syncContent() {
        const parser = new DOMParser();

        // 1. 공지사항 3개 동기화
        const notices = document.querySelectorAll('#notice-sync-list li');
        for (let li of notices) {
            const a = li.querySelector('a');
            const url = a.getAttribute('href');
            if (!url || url === "#") continue;

            try {
                const res = await fetch(url);
                if (!res.ok) throw new Error();
                const html = await res.text();
                const doc = parser.parseFromString(html, 'text/html');
                
                // h3 제목 추출
                const title = doc.querySelector('h3');
                if (title) a.innerText = title.innerText;
                
                // 날짜 추출 (숫자. 숫자. 숫자 형태)
                const dateMatch = doc.body.innerText.match(/\d{4}\.\s*\d{2}\.\s*\d{2}/);
                if (dateMatch) li.querySelector('.notice-date').innerText = dateMatch[0];
            } catch (e) {
                li.style.display = 'none'; 
            }
        }

        // 2. 갤러리 최신글 1개 동기화
        const galleryBox = document.querySelector('#gallery-sync-box .gallery-link');
        try {
            const res = await fetch('gallery_view/gallery_view_1.html');
            if (!res.ok) throw new Error();
            const html = await res.text();
            const doc = parser.parseFromString(html, 'text/html');

            const title = doc.querySelector('h3') ? doc.querySelector('h3').innerText : "최신 소식";
            
            // 이미지 경로 처리: 하위 페이지의 ../images/를 메인용 images/로 변환
            const imgElement = doc.querySelector('img');
            let imgSrc = "";
            if (imgElement) {
                imgSrc = imgElement.getAttribute('src').replace('../', ''); 
            }
            
            // 강조 문구(strong) 추출
            const boldMsg = doc.querySelector('strong') ? doc.querySelector('strong').innerText : "";
            const dateMatch = doc.body.innerText.match(/\d{4}\.\s*\d{2}\.\s*\d{2}/);

            galleryBox.innerHTML = `
                <img src="${imgSrc}" alt="Latest Gallery" onerror="this.src='images/logo.png';">
                <div class="gallery-preview-text">
                    <h4>${title}</h4>
                    <p><strong>${boldMsg}</strong></p>
                    <span class="notice-date">${dateMatch ? dateMatch[0] : ""}</span>
                </div>
            `;
        } catch (e) {
            console.log("Gallery sync failed.");
        }
    }

    window.addEventListener('DOMContentLoaded', syncContent);
</script>